# cmatrixライブラリ

C言語で列優勢(column-major)行列を扱うためのライブラリ

## 列優勢と行優勢

LAPACKなどの数値計算ライブラリは、Fortran言語を用いて書かれていることが多い。Fortran言語では、2次元配列(行列)の要素は各列の要素がメモリ上で連続して並ぶ。例えば、3x3行列では、要素はメモリ上で、(0,0)→(1,0)→(2,0)→(0,1)→(1,1)→(2,1)→…の順に配置される。これを「列優勢(column-major)」と呼ぶ。一方、C言語では、メモリ上でA[0][0]の次に配置されるのはA[0][1]、その
次はA[0][2]である。こちらを「行優勢(row-major)」と呼ぶ。

C言語上で行列の(i,j)成分を```A[i][j]```に代入したもの(row-major)をLAPACKライブラリに渡すと、LAPACK側では要素がcolumn-majorで並んでいると解釈して計算を行う。すなわち、入力行列が転置されてしまう。また、計算結果もC言語から見ると転置された状態で返されることになってしまう。

これを防ぐには、行列の(i,j)成分を```A[i][j]```ではなく```A[j][i]```に格
納ことに決めてプログラムを書けばよいのだが、「常に順番を逆に書く」というのはプログラム作成時に混乱してしまう恐れがある。一つの解決方法は、Cプリプロセッサのマクロ機能を使い、ソースコードの先頭で

```
#define mat_elem(mat, i, j) (mat)[(j)][(i)]
```

のようにmat_elem関数を定義することである(一般的にCプロセッサのマクロの多用は勧められていないが、背に腹は代えられない)。これにより、プログラム中で行列の(i,j)成分を```mat_elem(A, i, j)```と書けるようになる。

## 列データの連続性






